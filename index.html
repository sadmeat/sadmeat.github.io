<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Cache-control" content="no-cache">
    <meta http-equiv="Expires" content="-1">
    
    <link rel="manifest" href="/manifest.json">
    <script src="gl.matrix.js"></script>
    <script src="mic.js"></script>
    <script src="meat.verts.js"></script>
    <script src="meat.bones.js"></script>
    <script src="meat.vs.js"></script>
    <script src="meat.fs.js"></script>
    <script src="gl.js"></script>
    <script>
        // Initialize deferredPrompt for use later to show browser install prompt.
        let deferredPrompt;

        window.addEventListener('beforeinstallprompt', (e) => {
            // Prevent the mini-infobar from appearing on mobile
            e.preventDefault();
            // Stash the event so it can be triggered later.
            deferredPrompt = e;
            // Update UI notify the user they can install the PWA
            // showInstallPromotion();
            document.getElementById("installButton").style.display = 'inherit';
            // Optionally, send analytics event that PWA install promo was shown.
            console.log(`'beforeinstallprompt' event was fired.`);
        });

        const install = async () => {
            // Hide the app provided install promotion
            // hideInstallPromotion();
            // Show the install prompt
            deferredPrompt.prompt();
            // Wait for the user to respond to the prompt
            const { outcome } = await deferredPrompt.userChoice;
            // Optionally, send analytics event with outcome of user choice
            console.log(`User response to the install prompt: ${outcome}`);
            // We've used the prompt, and can't use it again, throw it away
            deferredPrompt = null;
        };


        window.onload = () => {
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('./sw.js').then(function (reg) {
                    console.log('Successfully registered service worker', reg);
                }).catch(function (err) {
                    console.warn('Error whilst registering service worker', err);
                });
            }

            glmain();
        }
    </script>

    <style>
    * {
        font-family: "Courier New";
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        -khtml-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
        box-sizing: border-box;
    }
    html, body {
        overflow: hidden;
        margin: 0;
    }
    
    html #settings {
        position: absolute;
        bottom: 0px;
        left: 0px;
        right: 0px;
        height: 50px;
        text-align: center;
        background: #fff;
        padding: 5px 10px;
        opacity: 0;
        transition: opacity 250ms;
    }
    
    html:hover #settings {
        opacity: 1;
    }
    canvas {
        margin: 0px auto;
        display: block;
    }
    
    #download {
        position: absolute;
        top: 0px;
        left: 0px;
        right: 0px;
        margin: 0px auto;
        display: block;
        background: #000;
        color: #6f8;
        padding: 15px 20px;
        animation: blinker 2s ease-in-out infinite;
    }
    #download * {color: #fff;}
    
    @keyframes blinker {
        50% { background: #666;}
    }
    
    .red {color: red}
    </style>
</head>
<body bgcolor="#0f0">
    <canvas id="canvas" height="800px" width="1000px"></canvas>
    
    <div id="download">
        Download the new Version of MeatCam V4.1
        <a href="https://drive.google.com/file/d/1Bkxjn1fCPDaMJs875QrEU3i6IwWxmDvT/view" target="_blank">here</a>!
        (<a href="#" onclick="this.parentElement.remove()">close</a>)<br/>
        <span style="color: #ffff80">Warning: Sometime anti aliasing makes problems. Deactivate it in the settings.ini!</span>
    </div>
    
    <div id="settings">
        Background: <input type="text" id="bcolor" value="00FF00" maxlength="6" size="6" 
        onkeyup="var b=this.value.match(/[\dA-Fa-f]{6}/)!==null; this.className=(b?'':'red'); document.bgColor='#'+(b?this.value:'0f0');"/> | 
        Sensitivity: <input type="range" min="0" max="0.99" value="0.8" step="0.01" id="sensitivity"/> |
        <input type="checkbox" id="activateHat"> Hat |
        <input type="checkbox" id="activateBlink"> Blink |
        <button onclick="this.innerHTML = toggleMic()?'Stop Mic':'Start Mic'">Start Mic</button> |
        <button onclick="location.reload(true)">Refresh</button>
        <button onclick="install()" id="installButton">INSTALL</button>
    </div>
</body>
</html>
